<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="/theme/css/style.less">
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->


  <link rel="icon" type="image/vnd.microsoft.icon" href="/">
  <link rel="stylesheet" type="text/css" href="/theme/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto+Mono">
  <link rel="stylesheet" type="text/css" href="/theme/css/fontawesome-all.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/hatena-bookmark-icon.css">

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Bhargav Bhat">
  <meta name="description" content="Posts and writings by Bhargav Bhat">
  <meta name="og:site_name" content="Bhargav's Homepage">

  <!-- Twitter Card -->


  <meta name="og:url" content="/modern-c-for_each-and-lambda-functions.html" />
  <meta name="og:title" content="Modern C++, `for_each` and lambda functions" />
  <meta name="og:description" content="TIL for_each and lambdas in Modern C++" />
  <meta name="keywords" content="cpp, cpp11, stl, til">


  <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Bhargav's Homepage Atom" />


  <title>
    Bhargav's Homepage
&ndash; Modern C++, `for_each` and lambda functions  </title></head>

<body>
  <main>
    <header>
      <div class="site-name">
        Bhargav's Homepage
      </div>
      <p>
      <a href="/index.html"><i class="fab fas-archive"></i>HOME&nbsp;|&nbsp;</a>
      <a href="/pages/about.html"><i class="fab fas-archive"></i>About&nbsp;|&nbsp;</a>
        <a href="/archives.html"><i class="fab fas-archive"></i>Archive&nbsp;|&nbsp;</a>
      <a href="/tags.html"><i class="fab fas-archive"></i>Tags&nbsp;|&nbsp;</a>
      <a href="/categories.html"><i class="fab fas-archive"></i>Categories</a>
      </p>
    </header>

<article>
  <div class="article__title">
    <h1><a href="/modern-c-for_each-and-lambda-functions.html">Modern C++, `for_each` and lambda functions</a></h1>
  </div>
  <div class="article__meta">
    <p class="article__meta__post-date">Posted on: Fri 09 August 2013</p>
 Tags:
      <a href="/tag/cpp.html">#cpp</a>,      <a href="/tag/cpp11.html">#cpp11</a>,      <a href="/tag/stl.html">#stl</a>,      <a href="/tag/til.html">#til</a>    </p>
  </div>
  <div class="article__text">
    <p>Considering that the current codebase I'm working on is mostly C++ and that we're making an effort as a team to move more towards C++ and the new "modern" C++, I wanted to look at idiomatic way of expressing the following in C++, using STL and C++ library functions where possible: convert a <code>vector</code> of <code>string</code>s into lowercase. The problem at hand was to deal with input from a separate application that needed to be parsed in as numbers.</p>
<h3><code>std::for_each</code></h3>
<p><code>std::for_each</code> is a handy function that works iterate over the elements of a container and applies a provided function to these elements. The function is documented in detail <a href="https://www.cplusplus.com/reference/algorithm/for_each/">here</a> and it is available from the <code>&lt;algorithm&gt;</code> header. It is very similar to the earlier <code>std::transform</code> however, the key difference is that <code>std::for_each</code> discards the function's return value where <code>std::transform</code> copies the return value to an element in the output container. Additionally, <code>std::for_each</code> guarantees the order of execution and is good for use with functions that cause side-effects. <code>std::transform</code> does not work well with either cases. Further differences and details of each are discussed in this awesome <a href="http://www.angelikalanger.com/Articles/Cuj/03.ForeachTransform/ForEachTransform.html">article</a>.</p>
<h3>Lambda Functions</h3>
<p>Lambda functions are blocks of code that can be treated as callable pieces of code. They are very similar to functors, and in fact, can be treated as "better" syntax for functors. There a bunch of advantages beyond cleaner syntax, that lambda functions have over functors, such as:</p>
<ul>
<li>can be used along with the <code>auto</code> keyword to be stored &amp; passed around</li>
<li>supports "capture" variables</li>
<li>none of the overheads of a class</li>
</ul>
<p>The simplest of lambda functions that captures nothing, accepts no parameters and performs no processing can be simply expressed as <code>[](){}</code> :D. Building up from here is more or less intuitive:</p>
<ul>
<li>the <code>[]</code> part specifies what objects a given lambda intends to capture from surrounding scope (beware of lifetime issues!)</li>
<li>the <code>()</code> part specifies what input arguments the lambda will take</li>
<li>and finally, the <code>{}</code> part encloses statemets that form the body of the lambda</li>
</ul>
<p>A very simple "odd or even" lambda can be defined as <code>[](int i) -&gt; bool {return (i%2) == 1;}</code>. Similarly, a simple lambda such as <code>auto print = [](int i) {cout &lt;&lt; i &lt;&lt; " ";};</code> can be defined and then used with <code>std::for_each</code> to print out the values of a <code>vector</code> of integers like so: <code>for_each(v1.begin(), v1.end(), print);</code></p>
<p>A more comprehensive coverage of lambda functions can be found <a href="https://smartbear.com/blog/c11-tutorial-lambda-expressions-the-nuts-and-bolts/">here</a> and <a href="https://www.codeguru.com/cplusplus/lambdas-in-vc-2010/">here</a>. </p>
<p>For this particular problem, lambda functions and <code>std::for_each</code> are the perfect fit.</p>
<h3>Putting it All Together</h3>
<p>Using lambdas and <code>std::for_each</code> together, the solution to the problem at hand is quite straight forward and the code is quite concise and readable:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;12&quot;</span><span class="p">,</span><span class="s">&quot;3.4&quot;</span><span class="p">,</span><span class="s">&quot;5.5E-6&quot;</span><span class="p">,</span><span class="s">&quot;-7e8&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">d</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">stod</span><span class="p">(</span><span class="n">v</span><span class="p">));</span><span class="w"> </span><span class="p">});</span><span class="w"></span>

<span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="nl">i</span> <span class="p">:</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Please note, in addition to the simple lambdas discussed earlier, this one actually captures the variable <code>d</code> by reference from the surrounding scope and updates it with the right values.</p>
<h3>Bonus : Range-based <code>for</code> Loops</h3>
<p>The last 3 lines of the code above are a good introduction to another handy feature in C++11 that is Range-based <code>for</code> loops, discussed in detail <a href="https://mbevin.wordpress.com/2012/11/14/range-based-for/">here</a> and <a href="https://www.cprogramming.com/c++11/c++11-ranged-for-loop.html">here</a>. This new syntax does away with a lot of boilerplate in <code>for</code> loops and allows for a consice way of iterating over the elements of an array or a container. Along with <code>auto</code> this reduces a lot of verbose code and allows programmers to focus on the intent rather than language minutae.</p>
<p>Although I have been reading a bunch of articles around C++11 and Modern C++ way of doing things, this was really the first time that I got an opportunity to try out these features in "real" code and the time saving as well as clarity that the new syntax and features bring are very much apparent.</p>
  </div>

</article>

  <div><p>&nbsp;</p><p>&nbsp;</p></div>
  </main>
    <footer>
      <!-- <div class="author__logo">
          <img src="/theme/images/logo.png" alt="logo">
      </div> -->
      <!-- <section class="author">
        <div class="author__name">
          <a href="/pages/about.html">Bhargav Bhat</a>
          <p></p>
        </div>
        <div class="author__link">
          <ul>
            <li>
              <a href="/feeds/all.atom.xml" target="_blank" title="Feed">
                <i class="fas fa-rss-square"></i>
              </a>
            </li>
          </ul>
	</div>
      </section> -->
      <div><p>&nbsp;</p><p>&nbsp;</p></div>
      <div class="ending-message">
        <p>&copy; Bhargav Bhat. Powered by <a href="http://getpelican.com" target="_blank">Pelican</a>, Theme is using <a href="https://github.com/laughk/pelican-hss" target="_blank">HSS</a>. </p>
      </div>
    </footer>
</body>
</html>